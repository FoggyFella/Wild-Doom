[gd_scene load_steps=81 format=2]

[ext_resource path="res://Assets/boss-2.png" type="Texture" id=1]
[ext_resource path="res://Assets/boss-3.png" type="Texture" id=2]
[ext_resource path="res://Assets/boss-1.png" type="Texture" id=3]
[ext_resource path="res://Scripts/Boss Guy.gd" type="Script" id=4]
[ext_resource path="res://Assets/circle-blood.png" type="Texture" id=5]
[ext_resource path="res://Assets/SFX/eneymshoot.wav" type="AudioStream" id=6]
[ext_resource path="res://Assets/SFX/enemyhurt.wav" type="AudioStream" id=7]
[ext_resource path="res://Assets/SFX/enemy death.wav" type="AudioStream" id=8]
[ext_resource path="res://Assets/boss-4.png" type="Texture" id=9]
[ext_resource path="res://Assets/boss-5.png" type="Texture" id=10]
[ext_resource path="res://Assets/Boss/Untitled 12-02-2022 07-50-59 (3).png" type="Texture" id=11]
[ext_resource path="res://Assets/Boss/Untitled 12-02-2022 07-50-59 (1).png" type="Texture" id=12]

[sub_resource type="Shader" id=29]
code = "shader_type canvas_item;

uniform vec4 flash_color : hint_color = vec4(1.0);
uniform float flash_modifier : hint_range(0.0, 1.0) = 1;
uniform float max_line_width = 10.0;
uniform float min_line_width = 5.0;
uniform float freq = 1.0;
uniform float block_size = 20.0;
uniform vec4 starting_colour = vec4(0,0,0,1);
uniform vec4 ending_colour = vec4(1);

const float pi = 3.1415;
const int ang_res = 16;
const int grad_res = 8;

float hash(vec2 p, float s) {
	return fract(35.1 * sin(dot(vec3(112.3, 459.2, 753.2), vec3(p, s))));
}

float noise(vec2 p, float s) {
	vec2 d = vec2(0, 1);
	vec2 b = floor(p);
	vec2 f = fract(p);
	return mix(
		mix(hash(b + d.xx, s), hash(b + d.yx, s), f.x),
		mix(hash(b + d.xy, s), hash(b + d.yy, s), f.x), f.y);
}

float getLineWidth(vec2 p, float s) {
	p /= block_size;
	float w = 0.0;
	float intensity = 1.0;
	for (int i = 0; i < 3; i++) {
		w = mix(w, noise(p, s), intensity);
		p /= 2.0;
		intensity /= 2.0;
	}
	
	return mix(max_line_width, min_line_width, w);
}

bool pixelInRange(sampler2D text, vec2 uv, vec2 dist) {
	float alpha = 0.0;
	for (int i = 0; i < ang_res; i++) {
		float angle = 2.0 * pi * float(i) / float(ang_res);
		vec2 disp = dist * vec2(cos(angle), sin(angle));
		if (texture(text, uv + disp).a > 0.0) return true;
	}
	return false;
}

float getClosestDistance(sampler2D text, vec2 uv, vec2 maxDist) {
	if (!pixelInRange(text, uv, maxDist)) return -1.0;
	
	float hi = 1.0; float lo = 0.0;
	
	for (int i = 1; i <= grad_res; i++) {
		float curr = (hi + lo) / 2.0;
		if (pixelInRange(text, uv, curr * maxDist)) {
			hi = curr;
		}
		else {
			lo = curr;
		}
	}
	return hi;
	
}

void fragment() {
	float timeStep = floor(freq * TIME);
	vec2 scaledDist = TEXTURE_PIXEL_SIZE;
	scaledDist *= getLineWidth(UV / TEXTURE_PIXEL_SIZE, timeStep);
	float w = getClosestDistance(TEXTURE, UV, scaledDist);
	
	if (( w > 0.0) && (texture(TEXTURE, UV).a < 0.2)) {
		COLOR = mix(starting_colour, ending_colour, tanh(3.0*w));
	}
	else {
		COLOR = texture(TEXTURE, UV);
	vec4 color = texture(TEXTURE, UV);
	color.rgb = mix(color.rgb, flash_color.rgb, flash_modifier );
	COLOR = color;
	}
	
}"

[sub_resource type="ShaderMaterial" id=30]
resource_local_to_scene = true
shader = SubResource( 29 )
shader_param/flash_color = Color( 1, 1, 1, 1 )
shader_param/flash_modifier = 0.0
shader_param/max_line_width = 0.0
shader_param/min_line_width = 0.0
shader_param/freq = 10.0
shader_param/block_size = 2.0
shader_param/starting_colour = Plane( 1, 0, 0, 0.3 )
shader_param/ending_colour = Plane( 1.3, 0.3, 0, 1 )

[sub_resource type="AtlasTexture" id=93]
atlas = ExtResource( 12 )
region = Rect2( 0, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=94]
atlas = ExtResource( 12 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=95]
atlas = ExtResource( 12 )
region = Rect2( 512, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=96]
atlas = ExtResource( 12 )
region = Rect2( 768, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=97]
atlas = ExtResource( 12 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=98]
atlas = ExtResource( 12 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=99]
atlas = ExtResource( 12 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=100]
atlas = ExtResource( 12 )
region = Rect2( 768, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=101]
atlas = ExtResource( 12 )
region = Rect2( 0, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=102]
atlas = ExtResource( 12 )
region = Rect2( 256, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=103]
atlas = ExtResource( 12 )
region = Rect2( 512, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=104]
atlas = ExtResource( 12 )
region = Rect2( 768, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=65]
atlas = ExtResource( 10 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=66]
atlas = ExtResource( 10 )
region = Rect2( 512, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=67]
atlas = ExtResource( 10 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=68]
atlas = ExtResource( 10 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=69]
atlas = ExtResource( 10 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=70]
atlas = ExtResource( 10 )
region = Rect2( 0, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=105]
atlas = ExtResource( 11 )
region = Rect2( 0, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=106]
atlas = ExtResource( 11 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=107]
atlas = ExtResource( 11 )
region = Rect2( 512, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=108]
atlas = ExtResource( 11 )
region = Rect2( 768, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=109]
atlas = ExtResource( 11 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=110]
atlas = ExtResource( 11 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=111]
atlas = ExtResource( 11 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=112]
atlas = ExtResource( 11 )
region = Rect2( 768, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=113]
atlas = ExtResource( 11 )
region = Rect2( 0, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=114]
atlas = ExtResource( 11 )
region = Rect2( 256, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=115]
atlas = ExtResource( 11 )
region = Rect2( 512, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=116]
atlas = ExtResource( 11 )
region = Rect2( 768, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=71]
atlas = ExtResource( 9 )
region = Rect2( 0, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=72]
atlas = ExtResource( 9 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=73]
atlas = ExtResource( 9 )
region = Rect2( 512, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=74]
atlas = ExtResource( 9 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=75]
atlas = ExtResource( 9 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=76]
atlas = ExtResource( 9 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=77]
atlas = ExtResource( 9 )
region = Rect2( 0, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=78]
atlas = ExtResource( 9 )
region = Rect2( 256, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=87]
atlas = ExtResource( 3 )
region = Rect2( 0, 512, 256, 256 )

[sub_resource type="AtlasTexture" id=88]
atlas = ExtResource( 3 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=89]
atlas = ExtResource( 3 )
region = Rect2( 768, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=90]
atlas = ExtResource( 3 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=91]
atlas = ExtResource( 3 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=92]
atlas = ExtResource( 3 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=79]
atlas = ExtResource( 2 )
region = Rect2( 0, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=80]
atlas = ExtResource( 2 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=81]
atlas = ExtResource( 2 )
region = Rect2( 512, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=82]
atlas = ExtResource( 2 )
region = Rect2( 768, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=83]
atlas = ExtResource( 2 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=84]
atlas = ExtResource( 2 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=85]
atlas = ExtResource( 2 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=86]
atlas = ExtResource( 10 )
region = Rect2( 0, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=59]
atlas = ExtResource( 1 )
region = Rect2( 0, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=60]
atlas = ExtResource( 1 )
region = Rect2( 256, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=61]
atlas = ExtResource( 1 )
region = Rect2( 512, 0, 256, 256 )

[sub_resource type="AtlasTexture" id=62]
atlas = ExtResource( 1 )
region = Rect2( 0, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=63]
atlas = ExtResource( 1 )
region = Rect2( 256, 256, 256, 256 )

[sub_resource type="AtlasTexture" id=64]
atlas = ExtResource( 1 )
region = Rect2( 512, 256, 256, 256 )

[sub_resource type="SpriteFrames" id=23]
animations = [ {
"frames": [ SubResource( 93 ), SubResource( 94 ), SubResource( 95 ), SubResource( 96 ), SubResource( 97 ), SubResource( 98 ), SubResource( 99 ), SubResource( 100 ), SubResource( 101 ), SubResource( 102 ), SubResource( 103 ), SubResource( 104 ) ],
"loop": false,
"name": "Attack1",
"speed": 8.0
}, {
"frames": [ SubResource( 65 ), SubResource( 66 ), SubResource( 67 ), SubResource( 68 ), SubResource( 69 ), SubResource( 70 ) ],
"loop": false,
"name": "Attack2",
"speed": 5.0
}, {
"frames": [ SubResource( 105 ), SubResource( 106 ), SubResource( 107 ), SubResource( 108 ), SubResource( 109 ), SubResource( 110 ), SubResource( 111 ), SubResource( 112 ), SubResource( 113 ), SubResource( 114 ), SubResource( 115 ), SubResource( 116 ) ],
"loop": true,
"name": "Attack3",
"speed": 8.0
}, {
"frames": [ SubResource( 71 ), SubResource( 72 ), SubResource( 73 ), SubResource( 74 ), SubResource( 75 ), SubResource( 76 ), SubResource( 77 ), SubResource( 78 ) ],
"loop": false,
"name": "BeforeJump",
"speed": 5.0
}, {
"frames": [ SubResource( 87 ), SubResource( 88 ), SubResource( 89 ), SubResource( 90 ), SubResource( 91 ), SubResource( 92 ) ],
"loop": false,
"name": "BoulderThrow",
"speed": 6.0
}, {
"frames": [ SubResource( 79 ), SubResource( 80 ), SubResource( 81 ), SubResource( 82 ), SubResource( 83 ), SubResource( 84 ), SubResource( 85 ) ],
"loop": true,
"name": "Idle",
"speed": 5.0
}, {
"frames": [ SubResource( 86 ) ],
"loop": true,
"name": "Jump",
"speed": 5.0
}, {
"frames": [ SubResource( 59 ), SubResource( 60 ), SubResource( 61 ), SubResource( 62 ), SubResource( 63 ), SubResource( 64 ) ],
"loop": true,
"name": "Walk",
"speed": 6.0
} ]

[sub_resource type="CapsuleShape2D" id=31]
radius = 15.0
height = 16.0

[sub_resource type="Animation" id=25]
resource_name = "Attack"
length = 1.05
step = 0.05
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.15, 0.3, 0.45, 0.6, 0.75, 0.9, 1.05 ),
"transitions": PoolRealArray( 1, 1, 1, 1, 1, 1, 1, 1 ),
"update": 1,
"values": [ 0, 1, 2, 3, 4, 5, 6, 7 ]
}

[sub_resource type="Animation" id=26]
resource_name = "Idle"
length = 1.2
loop = true
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.2, 0.4, 0.6, 0.8, 1, 1.2 ),
"transitions": PoolRealArray( 1, 1, 1, 1, 1, 1, 1 ),
"update": 1,
"values": [ 15, 16, 17, 18, 19, 20, 21 ]
}

[sub_resource type="Animation" id=27]
length = 0.001
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0 ),
"transitions": PoolRealArray( 1 ),
"update": 0,
"values": [ 8 ]
}

[sub_resource type="Animation" id=28]
resource_name = "Walk"
length = 1.05
loop = true
step = 0.05
tracks/0/type = "value"
tracks/0/path = NodePath("Sprite:frame")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/keys = {
"times": PoolRealArray( 0, 0.15, 0.3, 0.45, 0.6, 0.75, 0.9, 1.05 ),
"transitions": PoolRealArray( 1, 1, 1, 1, 1, 1, 1, 1 ),
"update": 1,
"values": [ 8, 9, 10, 11, 12, 13, 14, 15 ]
}

[sub_resource type="RectangleShape2D" id=32]
extents = Vector2( 23.5, 26 )

[sub_resource type="Curve2D" id=117]
_data = {
"points": PoolVector2Array( 0, 0, 0, 0, 20.047, -1.957, 0, 0, 0, 0, -28.953, -1.957, 0, 0, 0, 0, -2.953, -33.957, 0, 0, 0, 0, -2.953, 22.043, 0, 0, 0, 0, 13.047, -26.957, 0, 0, 0, 0, 13.047, 16.043, 0, 0, 0, 0, -22.953, 14.043, 0, 0, 0, 0, -21.953, -24.957, 0, 0, 0, 0, 16.047, -13.957, 0, 0, 0, 0, 17.047, 10.043, 0, 0, 0, 0, -22.953, 8.043, 0, 0, 0, 0, -12.953, -27.957 )
}

[node name="Boss Dude" type="KinematicBody2D"]
z_index = 2
collision_layer = 16
collision_mask = 4
script = ExtResource( 4 )

[node name="Sprite" type="AnimatedSprite" parent="."]
light_mask = 4
material = SubResource( 30 )
position = Vector2( 0, -38 )
scale = Vector2( 0.298828, 0.298828 )
frames = SubResource( 23 )
animation = "Attack2"
frame = 5

[node name="BulletSpawnPoint" type="Position2D" parent="Sprite"]
position = Vector2( -16.732, 127.163 )
scale = Vector2( 3.34641, 3.34641 )

[node name="crackpoint" type="Position2D" parent="Sprite"]
position = Vector2( -36.8105, 133.856 )

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2( -2, -24 )
shape = SubResource( 31 )

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
anims/Attack = SubResource( 25 )
anims/Idle = SubResource( 26 )
anims/RESET = SubResource( 27 )
anims/Walk = SubResource( 28 )

[node name="Shadow" type="Sprite" parent="."]
modulate = Color( 0, 0, 0, 0.435294 )
position = Vector2( 0, -0.229004 )
scale = Vector2( 2.875, 0.278625 )
z_index = -1
texture = ExtResource( 5 )

[node name="TimerTillAttack" type="Timer" parent="."]
wait_time = 4.0
one_shot = true

[node name="AttackTimer" type="Timer" parent="."]
wait_time = 0.75
one_shot = true

[node name="AttackTimer2" type="Timer" parent="."]
wait_time = 0.75
one_shot = true

[node name="TimerTillWalk" type="Timer" parent="."]
wait_time = 3.0
one_shot = true

[node name="ReadingUp" type="Timer" parent="."]
one_shot = true

[node name="Hitbox" type="Area2D" parent="."]
collision_layer = 0
collision_mask = 4

[node name="CollisionShape2D" type="CollisionShape2D" parent="Hitbox"]
position = Vector2( -1.5, -25 )
shape = SubResource( 32 )

[node name="hurt" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource( 7 )
volume_db = -11.361
attenuation = 4.43828
bus = "SoundEffects"

[node name="death" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource( 8 )
volume_db = -9.613
attenuation = 4.43828
bus = "SoundEffects"

[node name="shoot" type="AudioStreamPlayer2D" parent="."]
stream = ExtResource( 6 )
volume_db = -7.866
attenuation = 4.43828
bus = "SoundEffects"

[node name="burn_timer" type="Timer" parent="."]
one_shot = true

[node name="burn_tick" type="Timer" parent="."]
wait_time = 0.15

[node name="time_to_catch_on_fire" type="Timer" parent="."]
wait_time = 3.0
one_shot = true

[node name="flames_shield" type="Timer" parent="."]
wait_time = 0.75
one_shot = true

[node name="damage" type="Timer" parent="."]
wait_time = 0.1
one_shot = true

[node name="boulder_throw" type="Timer" parent="."]
wait_time = 0.8
one_shot = true

[node name="Path1" type="Path2D" parent="."]
visible = false
position = Vector2( 2.953, -22.043 )
curve = SubResource( 117 )

[node name="Path2" type="Path2D" parent="."]
visible = false
position = Vector2( 2.953, -22.043 )
curve = SubResource( 117 )

[connection signal="timeout" from="TimerTillAttack" to="." method="_on_TimerTillAttack_timeout"]
[connection signal="timeout" from="AttackTimer" to="." method="_on_AttackTimer_timeout"]
[connection signal="timeout" from="AttackTimer2" to="." method="_on_AttackTimer2_timeout"]
[connection signal="timeout" from="TimerTillWalk" to="." method="_on_TimerTillWalk_timeout"]
[connection signal="timeout" from="ReadingUp" to="." method="_on_ReadingUp_timeout"]
[connection signal="area_entered" from="Hitbox" to="." method="_on_Hitbox_area_entered"]
[connection signal="area_exited" from="Hitbox" to="." method="_on_Hitbox_area_exited"]
[connection signal="body_exited" from="Hitbox" to="." method="_on_Hitbox_body_exited"]
[connection signal="timeout" from="burn_timer" to="." method="_on_burn_timer_timeout"]
[connection signal="timeout" from="burn_tick" to="." method="_on_burn_tick_timeout"]
[connection signal="timeout" from="time_to_catch_on_fire" to="." method="_on_time_to_catch_on_fire_timeout"]
[connection signal="timeout" from="flames_shield" to="." method="_on_flames_shield_timeout"]
[connection signal="timeout" from="damage" to="." method="_on_damage_timeout"]
[connection signal="timeout" from="boulder_throw" to="." method="_on_boulder_throw_timeout"]
